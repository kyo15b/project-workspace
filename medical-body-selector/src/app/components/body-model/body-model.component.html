<!-- 3Däººé«”æ¨¡å‹çµ„ä»¶æ¨£æ¿ -->
<div class="body-model-container">
  
  <!-- è¼‰å…¥ç‹€æ…‹è¦†è“‹å±¤ -->
  <div class="loading-overlay" *ngIf="loadingState.isLoading || loadingState.hasError">
    <div class="loading-content">
      
      <!-- è¼‰å…¥ä¸­ -->
      <div *ngIf="loadingState.isLoading && !loadingState.hasError" class="loading-spinner-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">{{ loadingDisplay }}</div>
        <div class="loading-progress">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="loadingState.progress"></div>
          </div>
        </div>
      </div>

      <!-- éŒ¯èª¤ç‹€æ…‹ -->
      <div *ngIf="loadingState.hasError" class="error-container">
        <div class="error-icon">âš ï¸</div>
        <div class="error-text">{{ loadingDisplay }}</div>
        <button class="retry-button" (click)="reloadModel()">é‡æ–°è¼‰å…¥</button>
      </div>

    </div>
  </div>

  <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
  <div class="main-content" [class.model-loaded]="interactionState.isModelLoaded">
    
    <!-- 3Dæ¸²æŸ“å€åŸŸ -->
    <div class="canvas-container">
      <canvas #canvas class="render-canvas"></canvas>
      
      <!-- 3Då ´æ™¯æ§åˆ¶æç¤º -->
      <div class="canvas-overlay" *ngIf="interactionState.isModelLoaded">
        <div class="interaction-hints">
          <div class="hint-item">
            <span class="hint-icon">ğŸ–±ï¸</span>
            <span class="hint-text">é»æ“Šèº«é«”éƒ¨ä½é€²è¡Œé¸æ“‡</span>
          </div>
        </div>
      </div>
    </div>

    <!-- å´é‚Šæ§åˆ¶é¢æ¿ -->
    <div class="control-panel" *ngIf="interactionState.isModelLoaded">
      
      <!-- æ¨™é¡Œå€åŸŸ -->
      <div class="panel-header">
        <h2 class="panel-title">3Däººé«”æ¨¡å‹</h2>
        <div class="model-stats">
          <span class="stat-item">ç¸½éƒ¨ä½: {{ stats.totalParts }}</span>
          <span class="stat-divider">|</span>
          <span class="stat-item">å¯é»æ“Š: {{ stats.clickableParts }}</span>
        </div>
      </div>

      <!-- æœå°‹å€åŸŸ -->
      <div class="search-section">
        <div class="search-input-container">
          <input 
            type="text" 
            class="search-input"
            placeholder="æœå°‹èº«é«”éƒ¨ä½..." 
            [(ngModel)]="searchQuery"
            (input)="onSearch($event.target?.value || '')"
          >
          <button 
            class="search-clear-button" 
            *ngIf="searchQuery"
            (click)="onSearch('')"
          >
            âœ•
          </button>
        </div>
        <div class="search-results-info">{{ searchResultsInfo }}</div>
      </div>

      <!-- åˆ†é¡ç¯©é¸ -->
      <div class="category-section">
        <h3 class="section-title">èº«é«”éƒ¨ä½åˆ†é¡</h3>
        <div class="category-filters">
          <button
            *ngFor="let category of bodyPartsByCategory | keyvalue"
            class="category-button"
            [ngClass]="getCategoryCssClass(category.key)"
            (click)="filterByCategory(category.key)"
          >
            <span class="category-name">{{ getCategoryDisplayName(category.key) }}</span>
            <span class="category-count">({{ stats.categoryCounts[category.key] || 0 }})</span>
          </button>
        </div>
      </div>

      <!-- ç›®å‰ç‹€æ…‹é¡¯ç¤º -->
      <div class="status-section">
        
        <!-- é¸ä¸­çš„èº«é«”éƒ¨ä½ -->
        <div class="status-item selected-part" *ngIf="hasSelectedPart">
          <div class="status-label">
            <span class="status-icon">ğŸ‘†</span>
            <span class="status-text">å·²é¸æ“‡</span>
          </div>
          <div class="status-value selected-part-name">{{ selectedPartInfo }}</div>
          <button class="clear-selection-button" (click)="clearSelection()">æ¸…é™¤é¸æ“‡</button>
        </div>

        <!-- æ‡¸åœçš„èº«é«”éƒ¨ä½ -->
        <div class="status-item hovered-part" *ngIf="hasHoveredPart && !hasSelectedPart">
          <div class="status-label">
            <span class="status-icon">ğŸ‘€</span>
            <span class="status-text">æ‡¸åœä¸­</span>
          </div>
          <div class="status-value hovered-part-name">{{ hoveredPartInfo }}</div>
        </div>

        <!-- ç„¡é¸æ“‡ç‹€æ…‹ -->
        <div class="status-item no-selection" *ngIf="!hasSelectedPart && !hasHoveredPart">
          <div class="status-label">
            <span class="status-icon">â„¹ï¸</span>
            <span class="status-text">æç¤º</span>
          </div>
          <div class="status-value">é»æ“Š3Dæ¨¡å‹ä¸Šçš„èº«é«”éƒ¨ä½é€²è¡Œé¸æ“‡</div>
        </div>

      </div>

      <!-- èº«é«”éƒ¨ä½æ¸…å–® -->
      <div class="parts-list-section">
        <h3 class="section-title">
          èº«é«”éƒ¨ä½æ¸…å–®
          <span class="parts-count">({{ filteredBodyParts.length }})</span>
        </h3>
        
        <div class="parts-list-container">
          <div class="parts-list">
            <div
              *ngFor="let part of filteredBodyParts; trackBy: trackByPartName"
              class="part-item"
              [class.selected]="part === interactionState.selectedPart"
              [class.hovered]="part === interactionState.hoveredPart"
              [class.clickable]="part.clickable"
              (click)="selectBodyPart(part)"
            >
              <div class="part-info">
                <div class="part-name">{{ part.displayName }}</div>
                <div class="part-category">{{ getCategoryDisplayName(part.category) }}</div>
              </div>
              <div class="part-indicators">
                <span class="clickable-indicator" *ngIf="part.clickable" title="å¯é»æ“Š">ğŸ¯</span>
                <span class="highlighted-indicator" *ngIf="part.isHighlighted" title="å·²é«˜äº®">âœ¨</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ç©ºç‹€æ…‹æç¤º -->
        <div class="empty-state" *ngIf="filteredBodyParts.length === 0">
          <div class="empty-icon">ğŸ”</div>
          <div class="empty-text">
            <div class="empty-title">æ‰¾ä¸åˆ°åŒ¹é…çš„èº«é«”éƒ¨ä½</div>
            <div class="empty-subtitle">å˜—è©¦èª¿æ•´æœå°‹æ¢ä»¶æˆ–åˆ†é¡ç¯©é¸</div>
          </div>
          <button class="reset-filters-button" (click)="onSearch(''); filterByCategory('')">
            é‡ç½®ç¯©é¸
          </button>
        </div>
      </div>

    </div>
  </div>
</div>